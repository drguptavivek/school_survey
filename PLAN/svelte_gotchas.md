## Svelte / SvelteKit gotchas (observed)

- `use:enhance` does not automatically handle redirects; add a `redirect` branch and call `goto(result.location)` or you’ll stay on the same page after a 302 action.
- When disabling form fields with a loading flag, re-enable on `failure`/`error` results so retries are possible after a bad login.
- Logout should be a `+server.ts` endpoint, not a `+page.server.ts` load, to avoid “cookies.set after response generated” errors; clear cookies before redirect.
- Files under `src/routes` cannot have names starting with `+` (aside from route files); place tests in `src/tests/...` to avoid the “Files prefixed with + are reserved” warning.
- If `.svelte-kit/types` goes missing or stale (e.g., ENOENT for `proxy+page.server.ts`), remove `.svelte-kit/types` and run `npm run prepare` to regenerate; avoid keeping tests inside route folders to prevent type churn.
- Vite/Vitest do not auto-regenerate `.svelte-kit/types` if you deleted it; run `npm run prepare` (svelte-kit sync) before tests/dev, or add a `pretest` script to do it automatically.
- Elements with keyboard handlers need a role; add `role="presentation"` (or a meaningful role + label) when using keydown on non-interactive wrappers to clear a11y warnings.
- **TanStack Form + Native Form Submission**: When using `formEl?.submit()` for native form submission, hidden input fields must use local reactive variables (not `field.state.value`) to ensure the actual DOM value is synchronized before submission. The form data comes from DOM element values, not TanStack form's internal state. Use `value={selectedPartner}` instead of `value={field.state.value ?? ''}` for hidden inputs that need to be submitted with current values.
- **Checkbox Keyboard Accessibility**: Checkboxes need `tabindex="0"` to be included in the keyboard Tab order. Without it, they're skipped during keyboard navigation and users cannot reach them using Tab key.
- **HTML5 type="number" Input Limitation**: The HTML5 `type="number"` allows typing letters during input (they get stripped on submit). For stricter validation during typing, use `type="text"` with `inputmode="numeric"` and JavaScript input filtering (`.replace(/[^0-9]/g, '')`). This prevents users from typing non-numeric characters in the first place.
- **Drizzle Migrations Must Be Generate and then Applied**: When migrations are generated in `drizzle/` folder using `npm run db:generate`  (e.g., `0002_flaky_wraith.sql`), they don't automatically apply to the database. Run `npm run db:migrate` to apply pending migrations. Migration metadata is tracked in the `drizzle/.meta/` directory—don't manually edit these files. If migrations exist but database schema is missing columns, the migrations haven't been applied yet.
